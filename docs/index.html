<html><head><link href="https://werp.site/papyri/papyri.css" type="text/css" rel="stylesheet"></head><body><article><h1>fffff Documentation</h1><p><strong>fffff</strong> is a <a href="https://en.wikipedia.org/wiki/Stack-oriented_programming">stack-oriented</a> <a href="https://en.wikipedia.org/wiki/Concatenative_programming_language">concatenative programming language</a>. It has <a href="https://en.wikipedia.org/wiki/Type_system#Dynamic_type_checking_and_runtime_type_information">dynamic types</a>, and <a href="https://en.wikipedia.org/wiki/First-class_citizen">first-class</a> <a href="https://en.wikipedia.org/wiki/Scope_(computer_science)#Dynamic_scoping">dynamic scopes</a>. fffff is designed to be easy to implement, not easy to write in.</p><p>The following example defines a function named <code>square</code>, which squares the number on top of the stack by storing it in a local variable <code>x</code>, pushing two copies of <code>x</code> to the stack, then multiplying them:</p><p><a class="anchor"><span class="anchor-root"><span class="anchor-icon"><i class="fas fa-code"></i></span></span></a></p><pre class="panel listing source-code"><code>({ &gt;x x x * }) &gt;!square</code></pre><p>The following example then defines a function which takes the fourth power of the number on top of the stack, by calling <code>square</code> twice:</p><p><a class="anchor"><span class="anchor-root"><span class="anchor-icon"><i class="fas fa-code"></i></span></span></a></p><pre class="panel listing source-code"><code>(square square) &gt;!fourth</code></pre><p>This is effectively <a href="https://en.wikipedia.org/wiki/Function_composition_(computer_science)">function composition</a> &#8212; <code>fourth</code> is defined by composing <code>square</code> with itself. Programming in fffff is a mixture of low-level stack manipulation and high-level <a href="https://en.wikipedia.org/wiki/Point-free_programming">point-free</a> functional programming.</p><h2>Numbers</h2><p>The only numeric type is a signed 32-bit integer. An integer literal is written in decimal, with a leading&#160;<code>-</code> for negative numbers. An integer literal is an instruction which, when executed, pushes its own value to the stack.</p><p>There are the following numeric operations:</p><ul><li>Arithmetic: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>**</code> (power), <code>%</code> (modulo)</li><li>Bitwise: <code>&amp;</code>, <code>|</code>, <code>~</code> (inverse), <code>^</code> (xor), operating on the <a href="https://en.wikipedia.org/wiki/Two&#x27;s_complement">two&#8217;s complement</a> representation</li><li>Comparison: <code>=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code></li></ul><p>Operations take their operands off the stack and push their results to the stack, so for example <code>3 2 **</code> means &#8220;3 to the power of 2&#8221; and leaves <code>9</code> on the stack.</p><p><a class="anchor"><span class="anchor-root"><span class="anchor-icon"><i class="fas fa-info-circle"></i></span></span></a></p><div class="info panel">Note that the operation <code>**</code> is written after the instructions to push <code>3</code> and <code>2</code> to the stack; this is <a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">reverse Polish notation</a>.</div><h2>Booleans</h2><p>The keywords <code>true</code> and <code>false</code> are Boolean literals. They are instructions which, when executed, push their own value to the stack.</p><p>The logical operations are the keywords <code>and</code>, <code>or</code> and <code>not</code>. Logical operations likewise take their operands off the stack, leave their results on the stack, and must be written using reverse Polish notation.</p><p>The logical operations <code>and</code> and <code>or</code> are not <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">short-circuiting</a>, since their Boolean operands must already be on the stack.</p><h2>Strings</h2><p>A string literal is delimited by an odd number of single-quote characters&#160;<code>&#x27;</code>, or by an odd number of double-quote characters&#160;<code>&quot;</code>. The escape sequences <code>\&#x27;</code>, <code>\&quot;</code>, <code>\\</code>, <code>\n</code>, <code>\r</code>, <code>\t</code>, <code>\b</code> and <code>\f</code> have their usual meanings. A unicode escape sequence may be written in the form <code>\uXXXX</code>, where <code>XXXX</code> is a four-digit hexadecimal value.</p><p>If a string literal&#8217;s delimiter has three or more quote characters, then it is a multi-line string literal and may contain unescaped newlines. It is a syntax error for a string literal delimited by one quote character to contain an unescaped newline.</p><h2>Comments</h2><p>A line comment begins with a&#160;<code>#</code>. Everything from this character until the line ending is ignored. fffff does not have multiline comments, but they can be simulated with multi-line string literals:</p><p><a class="anchor"><span class="anchor-root"><span class="anchor-icon"><i class="fas fa-code"></i></span></span></a></p><pre class="panel listing source-code"><code>&quot;&quot;&quot;
This is a multi-line string, followed by the `del` keyword to delete it from
the top of the stack. This snippet will have no effect on the program&#x27;s
execution, so it is effectively a comment.
&quot;&quot;&quot; del</code></pre><h2>Printing</h2><p>The keywords <code>print</code> and <code>println</code> each pop a value from the stack and prints it to the console. The difference between them is that <code>println</code> also prints a newline. For example, the following program prints the text <a href="https://en.wikipedia.org/wiki/%22Hello,_World!%22_program">Hello, world!</a> to the console:</p><p><a class="anchor"><span class="anchor-root"><span class="anchor-icon"><i class="fas fa-code"></i></span></span></a></p><pre class="panel listing source-code"><code>&quot;Hello, world!&quot; println</code></pre><p>If the value to be printed is not a string, it is first converted to a string.</p><h2>Variables</h2><p>A variable name begins with a letter or underscore, followed by any number of letters, digits or underscores.</p><p>The operation&#160;<code>&gt;x</code> pops a value from the stack and stores it in the current scope; the operation <code>x</code> then pushes that value to the stack.</p><p>While it is convenient to think of variables as having values, this is <strong>not</strong> technically accurate. In fffff, variables contain <strong>instructions</strong>, and named functions (such as <code>square</code> in the example above) are also variables. The operation <code>&gt;x</code> does not store a value in the variable <code>x</code>; rather, it stores an instruction to push that value to the stack.</p><h2>Quotes</h2><p>A <strong>quote</strong> is analagous to a <a href="https://en.wikipedia.org/wiki/Anonymous_function">function literal</a> in other languages. Quotes are delimited by round brackets&#160;<code>(</code> and <code>)</code>. Instructions between these brackets are not executed immediately; rather, the quote itself is pushed to the stack, and its instructions will be executed whenever the quote is &#8220;called&#8221;. The operation&#160;<code>!</code> pops a quote from the stack, and calls it.</p><p>Quotes are immutable, and are first-class objects. A quote can be pushed to a stack or stored in a variable.</p><p>When a quote is stored in a variable with an instruction such as <code>&gt;f</code>, the variable <code>f</code> contains an instruction to push the quote to the stack; not to call it. The quote can be called by writing <code>f!</code>, which uses the <code>!</code> operation to call the quote.</p><p>Alternatively, the syntax&#160;<code>&gt;!f</code> can be used to store an instruction to call the quote, so that the quote can be called simply by writing <code>f</code>.</p><h2>Control flow</h2><p>The keyword <code>repeat</code> is a looping instruction which calls a quote repeatedly. Its operands are the quote and the number of repetitions. The following example prints the word &#8220;Hello&#8221; five times:</p><p><a class="anchor"><span class="anchor-root"><span class="anchor-icon"><i class="fas fa-code"></i></span></span></a></p><pre class="panel listing source-code"><code>(&quot;Hello&quot; println) 5 repeat</code></pre><p>The keyword <code>if</code> is a conditional instruction which calls (or doesn&#8217;t call) a quote depending on a Boolean condition. Its operands are the quote and a Boolean value. The following example prints the word &#8220;Hello&#8221; if <code>x</code> equals <code>y</code>, otherwise it does nothing:</p><p><a class="anchor"><span class="anchor-root"><span class="anchor-icon"><i class="fas fa-code"></i></span></span></a></p><pre class="panel listing source-code"><code>(&quot;Hello&quot; println) x y = if</code></pre><h2>Stacks</h2><p>Unlike other stack-based languages which use a single stack, fffff allows the use of local stacks.</p><p>A left square bracket&#160;<code>[</code> creates a new local stack and <strong>descends</strong> to it; a right square bracket&#160;<code>]</code> <strong>ascends</strong> from it. These are separate operations; in particular, it is <strong>not</strong> a syntax error for them to be unmatched.</p><p>Stacks are mutable, and are first-class objects. A reference to a stack can be pushed to another stack (or itself), or &#8220;stored&#8221; in a variable.</p><p>The operation&#160;<code>.[</code> <strong>enters</strong> a stack by popping a reference from the current stack and descending to it; the operation&#160;<code>].</code> <strong>exits</strong> the current stack by ascending from it and pushing a reference to it to the new current stack. For example, <code>[1 2 3].</code> creates a stack containing the numbers 1, 2, 3, leaving a reference to it on the current stack.</p><p><a class="anchor"><span class="anchor-root"><span class="anchor-icon"><i class="fas fa-info-circle"></i></span></span></a></p><div class="info panel">Note that there are no commas between the stack&#8217;s elements; the integer literals are really instructions to push values to the stack, with spaces separating the instructions.</div><p>The following keywords are operations on stacks:</p><ul><li><code>push</code> &#8212; for example, <code>[1 2 3]. 4 push</code> is equivalent to <code>[1 2 3 4].</code></li><li><code>pop</code> &#8212; for example, <code>[1 2 3]. pop</code> is equivalent to <code>[1 2]. 3</code></li><li><code>get</code> gets an element from the stack by index &#8212; for example, <code>[1 2 3]. 0 get</code></li><li><code>len</code> gives the length of the stack &#8212; for example, <code>[1 2 3]. len</code></li></ul><p>The keyword <code>stack</code> pushes a reference to the current stack to the current stack (i.e.&#160;itself).</p><h2>The metastack</h2><p>There is a special &#8220;stack of stacks&#8221; called the <strong>metastack</strong>, which is manipulated when descending to or ascending from a stack. The <strong>current stack</strong> is the one at the top of the metastack. Unless otherwise specified, in this documentation the phrase &#8220;the stack&#8221; means the current stack.</p><p>Initially, the metastack contains a single empty stack, which is the <strong>global stack</strong>. Descending to a stack pushes it to the metastack, making it the current stack; ascending from the current stack pops it from the metastack. It is a runtime error to ascend from the global stack leaving the metastack empty.</p><p>The metastack is not a first-class object; there is no way to obtain a reference to it.</p><h2>Scopes</h2><p>A scope contains variables, each of which is a name associated with an instruction. The instruction is either to push a value to the stack, or to call a quote.</p><p>A left curly brace&#160;<code>{</code> descends to a new local scope; a right curly brace&#160;<code>}</code> ascends from it. These are separate operations; in particular, it is <strong>not</strong> a syntax error for them to be unmatched.</p><p>Scopes are mutable, and are first-class objects. A reference to a scope can be pushed to a stack, or &#8220;stored&#8221; in a variable.</p><p>The operation&#160;<code>.{</code> enters a scope by popping a reference from the current stack and descending to it; the operation&#160;<code>}.</code> exits the current scope by ascending from it and pushing a reference to it to the current stack.</p><p>The keyword <code>this</code> pushes a reference to the current scope to the current stack.</p><h2>The scopestack</h2><p>Like the metastack, there is a special &#8220;stack of scopes&#8221; called the <strong>scopestack</strong>, which is manipulated when descending to or ascending from a scope. The <strong>current scope</strong> is the one at the top of the scopestack.</p><p>Initially, the scopestack contains a single empty scope, which is the <strong>global scope</strong>. Descending to a scope pushes it to the scopestack, making it the current scope; ascending from the current scope pops it from the scopestack. It is a runtime error to ascend from the global scope leaving the scopestack empty.</p><p>An instruction like <code>&gt;x</code> always stores in the current scope. However, the instruction <code>x</code> does not necessarily load from the current scope; it loads from whichever scope nearest the top of the scopestack has a variable named <code>x</code>. It is a runtime error if no scopes in the scopestack have such a variable. This is known as <a href="https://en.wikipedia.org/wiki/Scope_(computer_science)#Dynamic_scoping">dynamic scoping</a>.</p><p>The scopestack is not a first-class object; there is no way to obtain a reference to it.</p></article><script type="text/javascript" src="https://werp.site/papyri/papyri.js"></script></body></html>
