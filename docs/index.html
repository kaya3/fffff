<!DOCTYPE html>
<html><head><title>fffff Documentation</title><meta charset="utf-8"><link rel="stylesheet" type="text/css" href="https://kaya3.github.io/papyri/papyri.css"></head><body><article><h1><a class="anchor" href=""><i class="anchor-icon fas fa-link"></i> fffff Documentation</a></h1><p><b>fffff</b> is a <a href="https://en.wikipedia.org/wiki/Stack-oriented_programming">stack-oriented</a> <a href="https://en.wikipedia.org/wiki/Concatenative_programming_language">concatenative programming language</a>. It has <a href="https://en.wikipedia.org/wiki/Type_system#Dynamic_type_checking_and_runtime_type_information">dynamic types</a>, and <a href="https://en.wikipedia.org/wiki/First-class_citizen">first-class</a> <a href="https://en.wikipedia.org/wiki/Scope_(computer_science)#Dynamic_scoping">dynamic scopes</a>. fffff is designed to be easy to implement, not easy to write in.</p><p>The following example defines a function named <code>square</code>, which squares the number on top of the stack by duplicating the number on top of the stack, then multiplying the two copies of it:</p><pre class="panel listing"><code><span class="line" data-line-no="1">(@ *) &gt;!square</span>
</code></pre><p>The following example then defines a function which takes the fourth power of the number on top of the stack, by calling <code>square</code> twice:</p><pre class="panel listing"><code><span class="line" data-line-no="1">(square square) &gt;!fourth</span>
</code></pre><p>This is effectively <a href="https://en.wikipedia.org/wiki/Function_composition_(computer_science)">function composition</a> — <code>fourth</code> is defined by composing <code>square</code> with itself. Programming in fffff is a mixture of low-level stack manipulation and high-level <a href="https://en.wikipedia.org/wiki/Point-free_programming">point-free</a> functional programming.</p><h2 id="numbers"><a class="anchor" href="#numbers"><i class="anchor-icon fas fa-hashtag"></i> Numbers</a></h2><p>The only numeric type is a signed 32-bit integer. An integer literal is written in decimal, with a leading <code>-</code> for negative numbers. An integer literal is an instruction which, when executed, pushes its own value to the stack.</p><p>There are the following numeric operations:</p><ul><li>Arithmetic: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>**</code> (power), <code>%</code> (modulo)</li><li>Bitwise: <code>&amp;</code>, <code>|</code>, <code>~</code>, <code>^</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>&gt;&gt;&gt;</code>, operating on the <a href="https://en.wikipedia.org/wiki/Two&apos;s_complement">two’s complement</a> representation</li><li>Comparison: <code>=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code></li></ul><p>Operations take their operands off the stack and push their results to the stack, so for example <code>3 2 **</code> means “3 to the power of 2” and leaves <code>9</code> on the stack.</p><p><a class="anchor"><i class="anchor-icon fas fa-info-circle"></i></a></p><div class="info panel">Note that the operation <code>**</code> is written after the instructions to push <code>3</code> and <code>2</code> to the stack; this is <a href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">reverse Polish notation</a>.</div><h2 id="booleans"><a class="anchor" href="#booleans"><i class="anchor-icon fas fa-hashtag"></i> Booleans</a></h2><p>The keywords <code>true</code> and <code>false</code> are Boolean literals. They are instructions which, when executed, push their own value to the stack.</p><p>The logical operations are the keywords <code>and</code>, <code>or</code> and <code>not</code>. Logical operations likewise take their operands off the stack, leave their results on the stack, and must be written using reverse Polish notation.</p><p>The logical operations <code>and</code> and <code>or</code> are not <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">short-circuiting</a>, since their Boolean operands must already be on the stack.</p><h2 id="strings"><a class="anchor" href="#strings"><i class="anchor-icon fas fa-hashtag"></i> Strings</a></h2><p>A string literal is delimited by an odd number of single-quote characters <code>'</code>, or by an odd number of double-quote characters <code>"</code>. The escape sequences <code>\'</code>, <code>\"</code>, <code>\\</code>, <code>\n</code>, <code>\r</code>, <code>\t</code>, <code>\b</code> and <code>\f</code> have their usual meanings. A unicode escape sequence may be written in the form <code>\uXXXX</code>, where <code>XXXX</code> is a four-digit hexadecimal value.</p><p>If a string literal’s delimiter has three or more quote characters, then it is a multi-line string literal and may contain unescaped newlines. It is a syntax error for a string literal delimited by one quote character to contain an unescaped newline.</p><h2 id="basic_stack_manipulation"><a class="anchor" href="#basic_stack_manipulation"><i class="anchor-icon fas fa-hashtag"></i> Basic stack manipulation</a></h2><p>The <code>@</code> operation duplicates the top element of the stack. Repeating the <code>@</code> symbol gives a variation of this operation which duplicates an element further from the top of the stack; for example, <code>@@</code> duplicates the second-from-top element, <code>@@@</code> duplicates the third-from-top element, and so on.</p><p>The keyword <code>del</code> deletes the top element of the stack. This is equivalent to popping from the stack and discarding the result.</p><h2 id="comments"><a class="anchor" href="#comments"><i class="anchor-icon fas fa-hashtag"></i> Comments</a></h2><p>A line comment begins with a <code>#</code>. Everything from this character until the line ending is ignored. fffff does not have multiline comments, but they can be simulated with multi-line string literals:</p><pre class="panel listing"><code><span class="line" data-line-no="1">"""</span>
<span class="line" data-line-no="2">This is a multi-line string, followed by the `del` keyword to delete it from</span>
<span class="line" data-line-no="3">the top of the stack. This snippet will have no effect on the program's</span>
<span class="line" data-line-no="4">execution, so it is effectively a comment.</span>
<span class="line" data-line-no="5">""" del</span>
</code></pre><h2 id="printing"><a class="anchor" href="#printing"><i class="anchor-icon fas fa-hashtag"></i> Printing</a></h2><p>The keywords <code>print</code> and <code>println</code> each pop a value from the stack and print it to the console. The difference between them is that <code>println</code> also prints a newline. For example, the following program prints the text <a href="https://en.wikipedia.org/wiki/%22Hello,_World!%22_program">Hello, world!</a> to the console:</p><pre class="panel listing"><code><span class="line" data-line-no="1">"Hello, world!" println</span>
</code></pre><p>If the value to be printed is not a string, it is first converted to a string.</p><h2 id="variables"><a class="anchor" href="#variables"><i class="anchor-icon fas fa-hashtag"></i> Variables</a></h2><p>A variable name begins with a letter or underscore, followed by any number of letters, digits or underscores.</p><p>The operation <code>&gt;x</code> pops a value from the stack and stores it as a variable named <code>x</code> in the current scope. The operation <code>x</code> or <code>&lt;x</code> then loads that value and pushes it to the stack.</p><p><a class="anchor"><i class="anchor-icon fas fa-info-circle"></i></a></p><div class="info panel">The syntax <code>&gt;x</code> means “store into x”, and <code>&lt;x</code> means “load out of x”.</div><p>Since values are popped from the stack in reverse order, an instruction like <code>&gt;x &gt;y</code> will assign the top two values to <code>x</code> and <code>y</code> out of order. For convenience, the instruction <code>&gt;x,y</code> assigns them in order; this is equivalent to <code>&gt;y &gt;x</code>. Any number of variable names may be separated by commas in this way. You can also write <code>&lt;x,y</code> when loading multiple variables, but this is equivalent to <code>&lt;x &lt;y</code>.</p><p>While it is convenient to think of variables as having values, this is <b>not</b> technically accurate. In fffff, variables contain <b>instructions</b>, and named functions (such as <code>square</code> in the example above) are also variables. The operation <code>&gt;x</code> does not really store the <em>value</em> in the variable <code>x</code>; rather, it stores an instruction in the variable <code>x</code> to push that value to the stack. This matters because where a variable is defined as a function, it may do something other than simply push a stored value to the stack.</p><h2 id="quotes"><a class="anchor" href="#quotes"><i class="anchor-icon fas fa-hashtag"></i> Quotes</a></h2><p>A <b>quote</b> is analagous to a <a href="https://en.wikipedia.org/wiki/Anonymous_function">function literal</a> in other languages. Quotes are delimited by round brackets, <code>(</code> and <code>)</code>. Instructions between these brackets are not executed immediately; rather, the quote itself is pushed to the stack, and its instructions will be executed whenever the quote is “called”. The operation <code>!</code> pops a quote from the stack, and calls it.</p><p>Variable names inside quotes are resolved when the quote is called, <b>not</b> evaluated or bound when the quote is written. Quotes may occur inside other quotes.</p><p>Quotes are immutable, and are first-class objects. A quote can be pushed to a stack or stored in a variable.</p><p>When a quote is stored in a variable with an instruction such as <code>&gt;f</code>, the variable <code>f</code> contains an instruction to push the quote to the stack; not to call it. The quote can be called by writing <code>f!</code>, which uses the <code>!</code> operation to call the quote.</p><p>Alternatively, the syntax <code>&gt;!f</code> can be used to make <code>f</code> a <b>function</b> — the variable <code>f</code> holds an instruction to call the quote, so that the quote can be called simply by writing <code>f</code>.</p><h2 id="control_flow"><a class="anchor" href="#control_flow"><i class="anchor-icon fas fa-hashtag"></i> Control flow</a></h2><p>The keyword <code>repeat</code> is a looping instruction which calls a quote repeatedly. Its operands are the quote and the number of repetitions. The following example prints the word “Hello” five times:</p><pre class="panel listing"><code><span class="line" data-line-no="1">("Hello" println) 5 repeat</span>
</code></pre><p>The keyword <code>if</code> is a conditional instruction which calls (or doesn’t call) a quote depending on a Boolean condition. Its operands are the quote and a Boolean value. The following example prints the word “Hello” if <code>x</code> equals <code>y</code>, otherwise it does nothing:</p><pre class="panel listing"><code><span class="line" data-line-no="1">("Hello" println) x y = if</span>
</code></pre><h2 id="stacks"><a class="anchor" href="#stacks"><i class="anchor-icon fas fa-hashtag"></i> Stacks</a></h2><p>Unlike other stack-based languages which use a single stack, fffff allows the use of local stacks.</p><p>A left square bracket <code>[</code> creates a new local stack and <b>descends</b> to it. A right square bracket <code>]</code> <b>ascends</b> from it. These are separate operations; in particular, it is <b>not</b> a syntax error for them to be unmatched.</p><p>Stacks are mutable, and are first-class objects. A reference to a stack can be pushed to another stack (or itself), or “stored” in a variable.</p><p>The operation <code>.[</code> <b>enters</b> a stack by popping a reference from the current stack, and descending to the stack at that reference. The operation <code>].</code> <b>exits</b> the current stack by ascending from it and pushing a reference to it to the new current stack. For example, <code>[1 2 3].</code> creates a stack containing the numbers 1, 2, 3, leaving a reference to it on the current stack.</p><p><a class="anchor"><i class="anchor-icon fas fa-info-circle"></i></a></p><div class="info panel">Note that there are no commas between the stack’s elements. The integer literals are really instructions to push values to the stack, with spaces separating the instructions.</div><p>The following keywords are operations on stacks:</p><ul><li><code>push</code> — for example, <code>[1 2 3]. 4 push</code> is equivalent to <code>[1 2 3 4].</code></li><li><code>pop</code> — for example, <code>[1 2 3]. pop</code> is equivalent to <code>[1 2]. 3</code></li><li><code>get</code> gets an element from the stack by index — for example, <code>[1 2 3]. 0 get</code></li><li><code>len</code> gives the length of the stack — for example, <code>[1 2 3]. len</code></li></ul><p>The keyword <code>stack</code> pushes a reference to the current stack to the current stack (i.e. itself).</p><h2 id="the_metastack"><a class="anchor" href="#the_metastack"><i class="anchor-icon fas fa-hashtag"></i> The metastack</a></h2><p>There is a special “stack of stacks” called the <b>metastack</b>, which is manipulated when descending to or ascending from a stack. The <b>current stack</b> is the one at the top of the metastack. Unless otherwise specified, in this documentation the phrase “the stack” means the current stack.</p><p>Initially, the metastack contains a single empty stack, which is the <b>global stack</b>. Descending to a stack pushes it to the metastack, making it the current stack. Ascending from the current stack pops it from the metastack. It is a runtime error to ascend from the global stack leaving the metastack empty.</p><p>The metastack is not a first-class object; there is no way to obtain a reference to it.</p><h2 id="scopes"><a class="anchor" href="#scopes"><i class="anchor-icon fas fa-hashtag"></i> Scopes</a></h2><p>A scope contains variables, each of which is a name associated with an instruction. The instruction is either to push a value to the stack, or to call a quote.</p><p>A left curly brace <code>{</code> descends to a new local scope. A right curly brace <code>}</code> ascends from it. These are separate operations; in particular, it is <b>not</b> a syntax error for them to be unmatched.</p><p>Scopes are mutable, and are first-class objects. A reference to a scope can be pushed to a stack, or “stored” in a variable.</p><p>The operation <code>.{</code> enters a scope by popping a reference to it from the stack, and descending to the scope at that reference. The operation <code>}.</code> exits the current scope by ascending from it and pushing a reference to it to the stack.</p><p>For convenience, a variable can be accessed from a scope on the stack by writing <code>.x</code>. This is equivalent to <code>.{ &lt;x }</code>, so it enters the scope, loads <code>x</code>, and then exits the scope. This is analogous to member access in object-oriented programming languages, and allows scopes to be used as objects.</p><p>It is also possible to use member access in store/load instructions, for example <code>&gt;obj.x</code> or <code>&lt;obj.x</code>. These are equivalent to <code>obj .{ &gt;x }</code> and <code>&lt;obj .{ &lt;x }</code> respectively.</p><p>The keyword <code>this</code> pushes a reference to the current scope to the current stack.</p><h2 id="the_scopestack"><a class="anchor" href="#the_scopestack"><i class="anchor-icon fas fa-hashtag"></i> The scopestack</a></h2><p>Like the metastack, there is a special “stack of scopes” called the <b>scopestack</b>, which is manipulated when descending to or ascending from a scope. The <b>current scope</b> is the one at the top of the scopestack.</p><p>Initially, the scopestack contains a single empty scope, which is the <b>global scope</b>. Descending to a scope pushes it to the scopestack, making it the current scope. Ascending from the current scope pops it from the scopestack. It is a runtime error to ascend from the global scope leaving the scopestack empty.</p><p>An instruction like <code>&gt;x</code> always stores in the current scope, and an instruction like <code>&lt;x</code> always loads from the current scope. However, the instruction <code>x</code> does not necessarily load from the current scope; it loads from whichever scope nearest the top of the scopestack has a variable named <code>x</code>. It is a runtime error if no scopes in the scopestack have such a variable. This is known as <a href="https://en.wikipedia.org/wiki/Scope_(computer_science)#Dynamic_scoping">dynamic scoping</a>.</p><p>The scopestack is not a first-class object; there is no way to obtain a reference to it.</p></article><script type="text/javascript" src="https://kaya3.github.io/papyri/papyri.js"></script></body></html>